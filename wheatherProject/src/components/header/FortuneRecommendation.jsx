// src/components/header/FortuneRecommendation.jsx
import React, { useState, useCallback, useEffect } from 'react';
import { useSelector } from 'react-redux';
import { useGetCurrentWeatherQuery } from '../../services/WeatherApi.js';
import { FortuneModal } from './FortuneModal';

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * 1. ë (12ê°„ì§€) ì •ë³´
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const zodiacTraits = {
  'ì¥': {
    personality: 'ì˜ë¦¬í•˜ê³  ë¹ ë¥¸ íŒë‹¨ë ¥, ì‚¬êµì , ê¸°íšŒ í¬ì°© ëŠ¥ë ¥',
    fortune: 'ê¸ˆì „ ê°ê°ì´ ë›°ì–´ë‚˜ì§€ë§Œ ë³€ë™ì„±ì´ ìˆìŒ. ì¸ê°„ê´€ê³„ê°€ ë„“ì§€ë§Œ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ í•„ìš”',
  },
  'ì†Œ': {
    personality: 'ì„±ì‹¤í•˜ê³  ì¸ë‚´ì‹¬ ê°•í•¨, ê³ ì§‘ ì…ˆ, ì‹ ë¢°ë°›ëŠ” ì„±ê²©',
    fortune: 'ì•ˆì •ì ì¸ ì¬ë¬¼ìš´, ëŠë¦¬ì§€ë§Œ ê¾¸ì¤€íˆ ì„±ì¥. ê±´ê°•ì€ ì§€ë‚˜ì¹œ í”¼ë¡œ ì£¼ì˜',
  },
  'í˜¸ë‘ì´': {
    personality: 'ìš©ë§¹í•˜ê³  ë¦¬ë”ì‹­ ê°•í•¨, ë„ì „ì , ê°ì • ê¸°ë³µ ìˆìŒ',
    fortune: 'ë„ì „ì ì¸ ê¸°ì§ˆë¡œ ì¬ë¬¼ìš´ ê¸°ë³µì´ ìˆìŒ. ì§ì—…ì  ì„±ê³µ ê°€ëŠ¥ì„±ì´ í¬ì§€ë§Œ ëŒ€ì¸ê´€ê³„ ì¶©ëŒ ì£¼ì˜',
  },
  'í† ë¼': {
    personality: 'ì˜¨í™”í•˜ê³  ë°°ë ¤ì‹¬ ê¹ŠìŒ, ì˜ˆìˆ ì  ê°ê°, ì¡°ìš©í•˜ì§€ë§Œ ì§€í˜œë¡œì›€',
    fortune: 'ì¬ë¬¼ìš´ì€ ì•ˆì •ì ì´ì§€ë§Œ ì†Œê·¹ì ì¼ ìˆ˜ ìˆìŒ. ì¸ê°„ê´€ê³„ê°€ ì›ë§Œí•˜ì§€ë§Œ ì§€ë‚˜ì¹œ ë°°ë ¤ë¡œ ì†í•´ ë³¼ ê°€ëŠ¥ì„± ìˆìŒ',
  },
  'ìš©': {
    personality: 'ì¹´ë¦¬ìŠ¤ë§ˆ ìˆê³  ì•¼ë§ì´ í¼, ìì‹ ê° ë„˜ì¹¨',
    fortune: 'ì¬ë¬¼ìš´ì´ í¬ì§€ë§Œ ê¸°ë³µì´ ì‹¬í•¨. ë¦¬ë”ì‹­ ê°•í•˜ì§€ë§Œ ë…ì„ ì  íƒœë„ ì¡°ì‹¬',
  },
  'ë±€': {
    personality: 'ì§ê´€ë ¥ ë›°ì–´ë‚¨, ì‹ ë¹„ë¡œìš´ ë¶„ìœ„ê¸°, ë¶„ì„ì  ì‚¬ê³ ',
    fortune: 'íˆ¬ì ê°ê°ì´ ë›°ì–´ë‚˜ì§€ë§Œ ëŒ€ì¸ê´€ê³„ì—ì„œ ì˜¤í•´ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ. ê±´ê°•ì€ ì‹ ê²½ê³„ ì§ˆí™˜ ì£¼ì˜',
  },
  'ë§': {
    personality: 'ììœ ë¡­ê³  í™œë™ì , ë…ë¦½ì‹¬ ê°•í•¨, ì¶©ë™ì ',
    fortune: 'ì¬ë¬¼ìš´ì€ ì¢‹ì§€ë§Œ ê´€ë¦¬ê°€ í•„ìš”í•¨. ê±´ê°•ìš´ì€ ì¢‹ì§€ë§Œ ê³¼ë¡œ ì£¼ì˜',
  },
  'ì–‘': {
    personality: 'ì˜¨í™”í•˜ê³  ê°ì„±ì , ì˜ˆìˆ ì  ê¸°ì§ˆ, ì¡°ìš©í•œ ì„±í–¥',
    fortune: 'ì¬ë¬¼ìš´ì€ ì•ˆì •ì ì´ì§€ë§Œ ê¸°íšŒê°€ ì ì„ ìˆ˜ ìˆìŒ. ì¸ê°„ê´€ê³„ê°€ ì›ë§Œí•˜ì§€ë§Œ ê°ì • ê¸°ë³µ ì£¼ì˜',
  },
  'ì›ìˆ­ì´': {
    personality: 'ì˜ë¦¬í•˜ê³  ìœ ë¨¸ëŸ¬ìŠ¤í•¨, ì°½ì˜ì , ì¬ì¹˜ ìˆìŒ',
    fortune: 'ì¬ë¬¼ìš´ì´ ì¢‹ì§€ë§Œ ë³€ë™ì„±ì´ í¼. ëŒ€ì¸ê´€ê³„ì—ì„œ ì‹ ë¢°ë¥¼ ì–»ëŠ” ê²ƒì´ ì¤‘ìš”',
  },
  'ë‹­': {
    personality: 'ê¼¼ê¼¼í•˜ê³  ê³„íšì , ì™„ë²½ì£¼ì˜ ì„±í–¥',
    fortune: 'ì² ì €í•œ ê³„íšìœ¼ë¡œ ì¬ë¬¼ìš´ì´ ì¢‹ìŒ. ë‹¤ë§Œ ë„ˆë¬´ ì˜ˆë¯¼í•œ íƒœë„ëŠ” ì¸ê°„ê´€ê³„ì—ì„œ ë§ˆì´ë„ˆìŠ¤ê°€ ë  ìˆ˜ ìˆìŒ',
  },
  'ê°œ': {
    personality: 'ì¶©ì„±ì‹¬ ê°•í•˜ê³  ì •ì˜ë¡œì›€, ì‹ ì˜ê°€ ìˆìŒ',
    fortune: 'ì¬ë¬¼ìš´ì€ ì¤‘ê°„ ìˆ˜ì¤€ì´ì§€ë§Œ ì¸ê°„ê´€ê³„ì—ì„œ ì‹ ë¢°ë¥¼ ì–»ì–´ ì„±ê³µ ê°€ëŠ¥ì„±ì´ í¼',
  },
  'ë¼ì§€': {
    personality: 'ì†”ì§í•˜ê³  ê´€ëŒ€í•¨, ë‚™ì²œì ',
    fortune: 'ëˆì„ ì˜ ë²Œì§€ë§Œ ì‰½ê²Œ ì†Œë¹„í•˜ëŠ” ê²½í–¥. ê±´ê°•ìš´ì€ ì¢‹ì§€ë§Œ ì§€ë‚˜ì¹œ ë°©ì‹¬ ì£¼ì˜',
  },
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * 2. MBTI ì •ë³´
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const mbtiInfo = {
  ENTP: {
    trait: 'ì°½ì˜ì , ë§ì¬ì£¼ ì¢‹ìŒ, ì¦‰í¥ì ',
    fortune: 'ê¸°ë°œí•œ ì•„ì´ë””ì–´ë¡œ ì§ì—…ì  ì„±ê³µ ê°€ëŠ¥ì„±ì´ ë†’ìŒ. ì—°ì• ì—ì„œëŠ” ììœ ë¡œìš´ ìŠ¤íƒ€ì¼ì´ì§€ë§Œ ì¥ê¸°ì  ê´€ê³„ ìœ ì§€ê°€ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŒ',
  },
  ENTJ: {
    trait: 'ë¦¬ë”ì‹­ ê°•í•¨, ì•¼ë§ì´ í¼, ëª©í‘œ ì§€í–¥ì ',
    fortune: 'ê°•í•œ ì¶”ì§„ë ¥ìœ¼ë¡œ ì§ì—…ìš´ì´ ì¢‹ì§€ë§Œ, ëŒ€ì¸ê´€ê³„ì—ì„œ ì§€ë‚˜ì¹œ ë…ë‹¨ì„±ì„ ì£¼ì˜í•˜ì„¸ìš”',
  },
  ENFP: {
    trait: 'ê°ì„±ì , ì—ë„ˆì§€ê°€ ë„˜ì¹¨, ì°½ì˜ì ',
    fortune: 'ììœ ë¡œìš´ í™˜ê²½ì—ì„œ ì„±ê³µ ê°€ëŠ¥ì„±ì´ í¼. ì—°ì• ìš´ì´ ê°•í•˜ì§€ë§Œ ë³€ë•ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆìŒ',
  },
  ENFJ: {
    trait: 'ì‚¬êµì , íƒ€ì¸ ë°°ë ¤ ì˜í•¨, ì¹´ë¦¬ìŠ¤ë§ˆ ìˆìŒ',
    fortune: 'íƒ€ì¸ì„ ë•ëŠ” ì¼ì—ì„œ ì§ì—…ì  ì„±ì·¨ ê°€ëŠ¥. ì—°ì• ì—ì„œëŠ” í—Œì‹ ì ì´ì§€ë§Œ ë¶€ë‹´ì„ ì£¼ì§€ ì•Šë„ë¡ ìœ ì˜í•˜ì„¸ìš”',
  },
  ESTP: {
    trait: 'í˜„ì‹¤ì , ì¦‰í¥ì , í™œë™ì ',
    fortune: 'ì‹¤ì „ ê°ê°ì´ ë›°ì–´ë‚˜ ì¬ë¬¼ìš´ì´ ì¢‹ì§€ë§Œ ì¶©ë™ì  ì§€ì¶œì— ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤',
  },
  ESTJ: {
    trait: 'ì¡°ì§ì , í˜„ì‹¤ì£¼ì˜ì, ì‹ ë¢°ë°›ëŠ” ë¦¬ë”',
    fortune: 'ì² ì €í•œ ê³„íšìœ¼ë¡œ ì•ˆì •ì ì¸ ì§ì—…ìš´ì´ ìˆìœ¼ë‚˜ ìœµí†µì„±ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
  },
  ESFP: {
    trait: 'ì‚¬êµì , ê°ê°ì , ì¦‰í¥ì ',
    fortune: 'ì¦ê±°ìš´ ë¶„ìœ„ê¸°ë¥¼ ì˜ ì´ë„ëŠ” ì„±ê²©ìœ¼ë¡œ, ì—”í„°í…Œì¸ë¨¼íŠ¸Â·ì˜ˆìˆ  ë¶„ì•¼ì—ì„œ ë‘ê°ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤',
  },
  ESFJ: {
    trait: 'ì¹œì ˆí•˜ê³  ë°°ë ¤ì‹¬ ë§ìŒ, ê°ì„±ì ',
    fortune: 'ì¸ê°„ê´€ê³„ë¥¼ ì¤‘ì‹œí•˜ë©°, ì„œë¹„ìŠ¤ì—…Â·êµìœ¡ì—…ì—ì„œ í¬ê²Œ ë¹›ì„ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
  },
  INTP: {
    trait: 'ë…¼ë¦¬ì , ë…ì°½ì , ë‚´ì„±ì ',
    fortune: 'ì—°êµ¬ë‚˜ í•™ë¬¸ì ì¸ ë¶„ì•¼ì— ì í•©í•˜ë©°, ì—°ì• ì—ì„œëŠ” ê°ì • í‘œí˜„ì„ ë” ì‹ ê²½ ì¨ ë³´ì„¸ìš”',
  },
  INTJ: {
    trait: 'ì „ëµì , ë…ë¦½ì , ëª©í‘œ ì§€í–¥ì ',
    fortune: 'ì¥ê¸°ì  ê´€ì ì—ì„œ ê³„íšì„ ì„¸ìš°ë©´ ì„±ê³µ í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤. ê°ì •ì  êµë¥˜ë¥¼ ê°„ê³¼í•˜ì§€ ë§ˆì„¸ìš”',
  },
  INFP: {
    trait: 'ê°ì„±ì , ì´ìƒì£¼ì˜ì , ë‚´ë©´ì  ì„±ì°°',
    fortune: 'ì˜ˆìˆ ì  ê°ê°ì´ ë›°ì–´ë‚˜ë©° ì°½ì‘ ë¶„ì•¼ì—ì„œ ì„±ê³µ ê°€ëŠ¥ì„±. í˜„ì‹¤ì ì¸ ê¸ˆì „ ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤',
  },
  INFJ: {
    trait: 'ì§ê´€ì , ì´ìƒì£¼ì˜ì , ì‹ ë¹„ë¡œìš´ ë¶„ìœ„ê¸°',
    fortune: 'ì‚¬ëŒë“¤ì—ê²Œ ì˜ê°ê³¼ ë„ì›€ì„ ì£¼ì§€ë§Œ, ë‚´ë©´ì  ê°ˆë“±ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”',
  },
  ISTP: {
    trait: 'ë¶„ì„ì , ë…ë¦½ì , ì‹¤ìš©ì ',
    fortune: 'ê³µí•™Â·ê¸°ìˆ  ë¶„ì•¼ì—ì„œ ë‘ê°ì„ ë‚˜íƒ€ë‚´ë©°, ìƒí™© í•´ê²° ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤',
  },
  ISTJ: {
    trait: 'ì±…ì„ê° ê°•í•¨, ì‹ ì¤‘í•¨, í˜„ì‹¤ì ',
    fortune: 'ì•ˆì •ì ì¸ ì§ì—…ê³¼ ì¬ë¬¼ìš´ì„ ê¸°ëŒ€í•  ìˆ˜ ìˆìœ¼ë‚˜, ì§€ë‚˜ì¹œ ì›ì¹™ì£¼ì˜ì— ë¹ ì§€ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”',
  },
  ISFP: {
    trait: 'ê°ê°ì , ì¡°ìš©í•˜ì§€ë§Œ ê°œì„±ì´ ê°•í•¨',
    fortune: 'ì˜ˆìˆ  ê°ê°ì´ íƒì›”í•˜ê³  ììœ ë¡œìš´ í™˜ê²½ì—ì„œ ì ì¬ë ¥ì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤',
  },
  ISFJ: {
    trait: 'ì¡°ìš©í•˜ì§€ë§Œ í—Œì‹ ì , ì±…ì„ê° ê°•í•¨',
    fortune: 'ì‚¬ëŒë“¤ê³¼ì˜ ì‹ ë¢°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¼ì—ì„œ ë†’ì€ ì„±ì·¨ê°ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤',
  },
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * 3. ì—°ì• ìš´ (6ê°€ì§€)
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const loveFortuneList = [
  {
    label: 'ğŸ’– ìµœê³ ì˜ ì—°ì• ìš´',
    message: 'ì˜¤ëŠ˜ì€ ì‚¬ë‘ ì—ë„ˆì§€ê°€ ìµœê³ ì¡°! ì‹±ê¸€ì´ë¼ë©´ ìš´ëª…ì ì¸ ë§Œë‚¨ì´, ì—°ì•  ì¤‘ì´ë¼ë©´ ë”ìš± ê¹Šì–´ì§„ ê´€ê³„ë¥¼ ê¸°ëŒ€í•´ ë³´ì„¸ìš”.',
  },
  {
    label: 'ğŸ’“ ê´€ê³„ ë°œì „ ê¸°íšŒ',
    message: 'ì—°ì¸ê³¼ í•œ ê±¸ìŒ ë” ê°€ê¹Œì›Œì§ˆ ìˆ˜ ìˆëŠ” ìˆœê°„ì´ ë‹¤ê°€ì˜µë‹ˆë‹¤. ì„œë¡œ ì†”ì§í•œ ëŒ€í™”ë¥¼ ë‚˜ëˆ ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”?',
  },
  {
    label: 'ğŸ’› í‰ë²”í•œ ì—°ì• ìš´',
    message: 'í¬ê²Œ ì¢‹ì§€ë„ ë‚˜ì˜ì§€ë„ ì•Šì€, í‰ì˜¨í•œ ì—°ì• ìš´ì´ì—ìš”. í¸ì•ˆí•œ ë§ˆìŒìœ¼ë¡œ ì‚¬ëŒë“¤ì„ ëŒ€í•˜ë©´ ì¢‹ì€ ì¸ì—°ì´ ì´ì–´ì§ˆ ìˆ˜ ìˆì–´ìš”.',
  },
  {
    label: 'ğŸ’” ë¶ˆì•ˆì •í•œ ì—°ì• ìš´',
    message: 'ê°ì • ê¸°ë³µì´ë‚˜ ì˜¤í•´ê°€ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë‹ˆ, ë¶€ë“œëŸ¬ìš´ ëŒ€í™”ë¡œ í’€ì–´ë‚˜ê°€ëŠ” ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.',
  },
  {
    label: 'ğŸ’™ í˜¼ìë§Œì˜ ì‹œê°„ ì¶”ì²œ',
    message: 'ìì‹ ì„ ë¨¼ì € ëŒë´ì•¼ í•  ë•Œ! ì‚¬ë‘ë„ ì¢‹ì§€ë§Œ, ì˜¤ëŠ˜ì€ ìŠ¤ìŠ¤ë¡œë¥¼ ì±™ê¸°ëŠ” ì¼ì´ ìš°ì„ ì…ë‹ˆë‹¤.',
  },
  {
    label: 'ğŸ–¤ ì´ë³„ & ê±°ë¦¬ë‘ê¸°',
    message: 'ê°ˆë“±ì´ ê¹Šì–´ì§ˆ ìˆ˜ ìˆëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì´ì„±ì ì¸ ëŒ€í™”ê°€ ì¤‘ìš”í•˜ë©°, ìƒí™©ì— ë”°ë¼ ì ì‹œ ê±°ë¦¬ë¥¼ ë‘ëŠ” ê²ƒë„ ë°©ë²•ì…ë‹ˆë‹¤.',
  },
];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * 4. ì¬ë¬¼ìš´ (6ê°€ì§€)
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const moneyFortuneList = [
  {
    label: 'ğŸ’° ìµœê³ ì˜ ì¬ë¬¼ìš´',
    message: 'ê°‘ì‘ìŠ¤ëŸ¬ìš´ ìˆ˜ìµ ìƒìŠ¹ì´ë‚˜ ì¢‹ì€ ê¸°íšŒê°€ ì°¾ì•„ì˜¬ ìˆ˜ ìˆì–´ìš”. ì ê·¹ì ìœ¼ë¡œ ì›€ì§ì—¬ ë³´ë©´ ì–´ë–¨ê¹Œìš”?',
  },
  {
    label: 'ğŸ“ˆ ì•ˆì •ì ì¸ ì¬ë¬¼ìš´',
    message: 'ì˜¤ë¥´ì§€ë„ ë‚´ë¦¬ì§€ë„ ì•ŠëŠ”, ë¬´ë‚œí•œ íë¦„ì´ì—ìš”. ì°¨ê·¼ì°¨ê·¼ ì €ì¶•í•˜ë©° ì¬ì •ì ì¸ ì•ˆì „ë§ì„ ìŒ“ê¸° ì¢‹ì•„ìš”.',
  },
  {
    label: 'ğŸ¦ ì €ì¶• & ê³„íš ì¶”ì²œ',
    message: 'ì˜¤ëŠ˜ì€ ìˆ˜ì…ì„ ëŠ˜ë¦¬ê¸°ë³´ë‹¤ëŠ” ë¯¸ë˜ ëŒ€ë¹„ ê³„íšì— ì§‘ì¤‘í•´ ë³´ì„¸ìš”. ì‘ì€ ì ˆì•½ ìŠµê´€ì´ í° ë„ì›€ì´ ë©ë‹ˆë‹¤.',
  },
  {
    label: 'ğŸ’¸ ì§€ì¶œ ì¦ê°€ ì£¼ì˜',
    message: 'ì¶©ë™ êµ¬ë§¤ë‚˜ ì˜ˆìƒì¹˜ ëª»í•œ ë¹„ìš©ì´ ìƒê¸¸ ìˆ˜ ìˆì–´ìš”. í•œë²ˆ ë” ì‹ ì¤‘í•˜ê²Œ ìƒê°í•´ ë³´ëŠ” ê²Œ ì¢‹ì•„ìš”!',
  },
  {
    label: 'âš ï¸ ìœ„í—˜í•œ íˆ¬ì ì£¼ì˜',
    message: 'íˆ¬ìë‚˜ ì§€ì¶œì— ì‹¤íŒ¨ í™•ë¥ ì´ ë†’ìœ¼ë‹ˆ ë¬´ë¦¬í•œ ì‹œë„ëŠ” ê¸ˆë¬¼! ê¼¼ê¼¼í•œ ê³„íšì„ ì„¸ìš°ì„¸ìš”.',
  },
  {
    label: 'ğŸš¨ í° ì†ì‹¤ ìœ„í—˜',
    message: 'ì‚¬ê¸°ë‚˜ ê³¼ì†Œë¹„ ê°™ì€ ì»¤ë‹¤ë€ ê¸ˆì „ ë‚­ë¹„ ê°€ëŠ¥ì„±ì´ ë³´ì…ë‹ˆë‹¤. ì¤‘ìš”í•œ ê²°ì •ì€ ì ì‹œ ë¯¸ë£¨ëŠ” í¸ì´ ì•ˆì „í•´ìš”.',
  },
];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * 5. ë‚ ì”¨ í•œê¸€ ë³€í™˜
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const weatherKor = {
  clear: 'ë§‘ìŒ',
  clouds: 'êµ¬ë¦„',
  rain: 'ë¹„',
  snow: 'ëˆˆ',
  thunderstorm: 'ì²œë‘¥ë²ˆê°œ',
  mist: 'ì•ˆê°œ',
  default: 'ê¸°íƒ€',
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * 6. ë‚ ì”¨ ì˜í–¥ ì •ë³´
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const weatherInfluence = {
  clear: {
    text: 'í™”ì°½í•œ í•˜ëŠ˜ì´ ê¸°ë¶„ê¹Œì§€ ë°ê²Œ ë§Œë“¤ì–´ ì£¼ëŠ” í•˜ë£¨ì˜ˆìš”.',
    energy: 'í™œê¸°ì°¨ê³  ì°½ì¡°ì ì¸',
    advice: 'ìƒˆë¡œìš´ ë„ì „ì„ ì‹œì‘í•˜ê±°ë‚˜ ëª©í‘œë¥¼ ì„¸ì›Œ ë³´ì‹œëŠ” ê±´ ì–´ë–¨ê¹Œìš”? ìì‹ ê°ì´ ìƒ˜ì†Ÿì„ ê±°ì˜ˆìš”!',
  },
  clouds: {
    text: 'êµ¬ë¦„ ë‚€ ë‚ ì”¨ê°€ ì˜¤íˆë ¤ ì°¨ë¶„í•œ ì§‘ì¤‘ë ¥ì„ ì„ ì‚¬í•©ë‹ˆë‹¤.',
    energy: 'ì¹¨ì°©í•˜ê³  ì‹ ì¤‘í•œ',
    advice: 'ë³µì¡í•œ ê³ ë¯¼ì„ ì •ë¦¬í•˜ê³ , ë‚´ë©´ì— ëª°ì…í•´ ë³´ëŠ” ì‹œê°„ì„ ê°€ì ¸ë³´ì„¸ìš”.',
  },
  rain: {
    text: 'ë¹„ ë‚´ë¦¬ëŠ” í’ê²½ì´ ì„¸ìƒì„ ì°¨ë¶„í•˜ê²Œ ì ì…” ì£¼ëŠ” ë‚ ì…ë‹ˆë‹¤.',
    energy: 'ê°ì„±ì ì´ê³  ì§ê´€ì ì¸',
    advice: 'ê°€ë²¼ìš´ ê°ì • ì •ë¦¬ê°€ í•„ìš”í•˜ë‹¤ë©´ ì°¨ í•œ ì”ê³¼ í•¨ê»˜ ì—¬ìœ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”.',
  },
  snow: {
    text: 'ëˆˆì´ ë‚´ë ¤ ì„¸ìƒì´ ê³ ìš”í•´ì§€ëŠ” ë¶„ìœ„ê¸°ì˜ˆìš”.',
    energy: 'ì°¨ë¶„í•˜ê³  ê²°ë‹¨ë ¥ ìˆëŠ”',
    advice: 'ìƒˆë¡œìš´ ê³„íšì„ ì„¸ìš°ê±°ë‚˜ ì§‘ì¤‘ì´ í•„ìš”í•œ ì‘ì—…ì„ í•˜ê¸°ì— ì¢‹ì€ ë‚ ì…ë‹ˆë‹¤.',
  },
  thunderstorm: {
    text: 'ì²œë‘¥ë²ˆê°œë¡œ ë‹¤ì´ë‚´ë¯¹í•œ ì—ë„ˆì§€ê°€ ê°ë„ëŠ” ë‚ ì´ë„¤ìš”.',
    energy: 'ì—­ë™ì ì´ê³  ê°•í•œ ì¶”ì§„ë ¥',
    advice: 'ìœ„í—˜ë„ ìˆì§€ë§Œ ê¸°íšŒë„ ë§ìŠµë‹ˆë‹¤. ê³¼ê°í•œ ë„ì „ ì „ì— ê¼­ ì‹ ì¤‘í•œ íŒë‹¨ì„ í•´ë³´ì„¸ìš”.',
  },
  mist: {
    text: 'ì•ˆê°œê°€ ê°€ë“í•´ ì‹œì•¼ê°€ íë¦¿í•˜ì§€ë§Œ, ìƒìƒë ¥ì€ í’ë¶€í•´ì§‘ë‹ˆë‹¤.',
    energy: 'ì‹ ë¹„ë¡­ê³  íƒêµ¬ì ì¸',
    advice: 'ì—¬ëŸ¬ ê°€ëŠ¥ì„±ì„ ì—´ì–´ë‘ê³ , ì§ê´€ì ì¸ ê²°ì •ì„ ë‚´ë¦¬ëŠ” ê²ƒë„ ë‚˜ì˜ì§€ ì•Šì•„ìš”.',
  },
  default: {
    text: 'ë‚ ì”¨ ìƒíƒœê°€ ì¡°í™”ë¡­ê²Œ ìœ ì§€ë˜ê³  ìˆìŠµë‹ˆë‹¤.',
    energy: 'ì•ˆì •ì ì´ê³  ì¡°í™”ë¡œìš´',
    advice: 'í‰ì˜¨í•œ ë¶„ìœ„ê¸° ì†ì—ì„œ ê¾¸ì¤€íˆ ë…¸ë ¥í•˜ë©´ ì¢‹ì€ ê²°ê³¼ê°€ ìˆì„ ê±°ì˜ˆìš”.',
  },
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 * 7. ì»´í¬ë„ŒíŠ¸ ì‹œì‘
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
export default function FortuneRecommendation({ onClose }) {
  // ìœ„ì¹˜, ë‚ ì”¨ API ì •ë³´
  const { lat, lng } = useSelector((state) => state.geolocation.geolocation);
  const { data: weatherData, isSuccess } = useGetCurrentWeatherQuery({ lat, lng });

  // ë¡œê·¸ì¸ ì‚¬ìš©ì ì •ë³´ (auth.user)
  const currentUser = useSelector((state) => state.auth.user);

  // ì»´í¬ë„ŒíŠ¸ ìƒíƒœ
  const [fortune, setFortune] = useState('');
  const [error, setError] = useState('');
  const [showFortuneModal, setShowFortuneModal] = useState(false);

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * ë  ê³„ì‚° í•¨ìˆ˜
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const getZodiacAnimal = (year) => {
    const zodiacAnimals = [
      'ì›ìˆ­ì´', 'ë‹­', 'ê°œ', 'ë¼ì§€', 'ì¥',
      'ì†Œ', 'í˜¸ë‘ì´', 'í† ë¼', 'ìš©', 'ë±€',
      'ë§', 'ì–‘',
    ];
    const baseYear = 2016; // ì›ìˆ­ì´ë  ê¸°ì¤€
    const index = (year - baseYear) % 12;
    return zodiacAnimals[(index + 12) % 12];
  };

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * ìœ íš¨ì„± ê²€ì‚¬
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const validateUserData = useCallback(() => {
    if (!currentUser) {
      setError('ì‚¬ìš©ì ì •ë³´ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      return false;
    }
    if (!currentUser.mbti || !currentUser.birthdate || !currentUser.gender) {
      setError('í•„ìš”í•œ ì‚¬ìš©ì ì •ë³´(mbti, birthdate, gender)ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.');
      return false;
    }
    const birth = new Date(currentUser.birthdate);
    if (isNaN(birth.getTime())) {
      setError('ì‚¬ìš©ì ìƒë…„ì›”ì¼ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      return false;
    }
    return true;
  }, [currentUser]);

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * ì—°ì• ìš´Â·ì¬ë¬¼ìš´ ëœë¤ ì„ íƒ í•¨ìˆ˜
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const getRandomLoveFortune = () => {
    const randomIndex = Math.floor(Math.random() * loveFortuneList.length);
    return loveFortuneList[randomIndex];
  };

  const getRandomMoneyFortune = () => {
    const randomIndex = Math.floor(Math.random() * moneyFortuneList.length);
    return moneyFortuneList[randomIndex];
  };

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   * ìš´ì„¸ ê³„ì‚° í•¨ìˆ˜
   * (í•˜ë‚˜ì˜ ë¬¸ë‹¨ìœ¼ë¡œ í†µí•©í•´ ë§íˆ¬ë¥¼ ë¶€ë“œëŸ½ê²Œ)
   * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const calculateFortune = useCallback(() => {
    if (!validateUserData() || !isSuccess || !weatherData) return;

    try {
      const birthDate = new Date(currentUser.birthdate);
      const birthYear = birthDate.getFullYear();
      const zodiac = getZodiacAnimal(birthYear);                // ë 
      const mbtiKey = (currentUser.mbti || '').toUpperCase();   // MBTI

      // ë  ì •ë³´ ì°¾ê¸°
      const zodiacData = zodiacTraits[zodiac] || {
        personality: 'ì •ë³´ ì—†ìŒ',
        fortune: 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.',
      };

      // MBTI ì •ë³´ ì°¾ê¸°
      const mbtiData = mbtiInfo[mbtiKey] || {
        trait: 'ì •ë³´ ì—†ìŒ',
        fortune: 'ì•Œ ìˆ˜ ì—†ëŠ” ìœ í˜•ì…ë‹ˆë‹¤.',
      };

      // ë‚ ì”¨ ì •ë³´
      const weatherMainEn = weatherData.weather[0].main.toLowerCase();  // ì˜ˆ: "clear"
      const weatherMainKor = weatherKor[weatherMainEn] || weatherKor.default;  // í•œê¸€ ë³€í™˜
      const weatherObj = weatherInfluence[weatherMainEn] || weatherInfluence.default;
      const temp = Math.round(weatherData.main.temp);

      // ì‹œê°„ëŒ€
      const currentHour = new Date().getHours();
      const timeOfDay =
        currentHour >= 5 && currentHour < 12
          ? 'ì•„ì¹¨'
          : currentHour >= 12 && currentHour < 18
            ? 'ì˜¤í›„'
            : currentHour >= 18 && currentHour < 22
              ? 'ì €ë…'
              : 'ë°¤';

      // ì—°ì• ìš´ / ì¬ë¬¼ìš´ ëœë¤ ì„ ì •
      const todayLove = getRandomLoveFortune();
      const todayMoney = getRandomMoneyFortune();

      // ë¶€ë“œëŸ¬ìš´ ë§íˆ¬ì˜ ìµœì¢… ìš´ì„¸ ë¬¸êµ¬
      const fortuneText = `
[${new Date().toLocaleDateString()} ${timeOfDay}]

ì˜¤ëŠ˜ì€ '${zodiac}'ë  íŠ¹ìœ ì˜ â€œ${zodiacData.personality}â€ì˜ ë©´ëª¨ê°€ ë”ìš± í™œì•½í•  ê²ƒ ê°™ì•„ìš”. 
MBTI: ${currentUser.mbti}(${mbtiData.trait}) ì„±í–¥ë„ í•¨ê»˜ ì‘ìš©í•´ì„œ, 
ë‹¹ì‹ ì˜ í•˜ë£¨ì— í†¡í†¡ íŠ€ëŠ” ì—ë„ˆì§€ë¥¼ ì„ ì‚¬í•  ì „ë§ì…ë‹ˆë‹¤. 

ë‚ ì”¨ëŠ” '${weatherMainKor}'(ì•½ ${temp}â„ƒ)ë¡œ, ${weatherObj.text} 
ë•ë¶„ì— '${weatherObj.energy}' ê¸°ìš´ì´ ê°ëŒê³  ìˆë„¤ìš”. 
"${weatherObj.advice}" 

ì—°ì• ìš´: ${todayLove.label}  
"${todayLove.message}" 

ì¬ë¬¼ìš´: ${todayMoney.label}  
"${todayMoney.message}" 

ê·¸ë¦¬ê³  ${mbtiData.fortune} 
ë˜í•œ, '${zodiacData.fortune}'ì— ëŒ€í•´ ì°¸ê³ í•˜ì‹œë©´ 
ì˜¤ëŠ˜ í•˜ë£¨ì— ë”ìš± ì•Œì°¬ ì„ íƒì„ í•˜ì‹¤ ìˆ˜ ìˆì„ ë“¯í•©ë‹ˆë‹¤.

í–‰ë™ í•˜ë‚˜í•˜ë‚˜ì— ë°°ë ¤ì™€ ìì‹ ê°ì„ ë‹´ì•„ë³´ì„¸ìš”. 
ë‹¹ì‹ ì˜ í•˜ë£¨ê°€ ë”ìš± ë°˜ì§ì´ê¸¸ ì‘ì›í•©ë‹ˆë‹¤!
`;

      setFortune(fortuneText.trim());
      setShowFortuneModal(true);
    } catch (err) {
      console.error('ìš´ì„¸ ê³„ì‚° ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', err);
      setError('ìš´ì„¸ ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    }
  }, [currentUser, isSuccess, weatherData, validateUserData]);

  // currentUser ë³€ê²½ ì‹œ ìë™ ì‹¤í–‰
  useEffect(() => {
    if (currentUser) {
      calculateFortune();
    }
  }, [currentUser, calculateFortune]);

  // ëª¨ë‹¬ ë‹«ê¸°
  const handleFortuneModalClose = () => {
    setShowFortuneModal(false);
    onClose();
  };

  // ë Œë”ë§
  return (
    <div className="fixed inset-0 z-50">
      {showFortuneModal && fortune && (
        <FortuneModal fortune={fortune} onClose={handleFortuneModalClose} />
      )}
      {error && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
          <div className="bg-white p-6 rounded text-black">
            <p className="mb-4">{error}</p>
            <button
              onClick={onClose}
              className="rounded bg-blue-500 px-4 py-2 text-white hover:bg-blue-600"
            >
              ë‹«ê¸°
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
